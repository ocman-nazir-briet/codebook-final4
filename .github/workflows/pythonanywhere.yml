name: Deploy to PythonAnywhere

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      - name: Deploy to PythonAnywhere
        uses: appleboy/ssh-action@master
        with:
          username: ocman
          key: f31cac94cdec44cc414f8d4050013fc3b102e148
          host: ssh.pythonanywhere.com
          known_hosts: |
            ssh.pythonanywhere.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCc9rEXrKbnwj+wvPHKk1wLzKLs7sLu4ZzsdVqO9lT84uVYQ2OyE/+VbH2kOmftKgFKvzZJrx+hAagX9KjAGC6bYATy0JhLns+nogak92thze/P5v5N5kWnwoNyQJhFt/UKgY8szKt3tzqBbPyiIDkzv+f8mZB9AXX9G0R5KjTpBb8yWq3xOoZUMem0op2j+ZD1lEM1X0yTYLnjKkIMrGLjlEoJHZx5pJMHcOD5vHHaJGK9y26n/ttIbW8dkvJfLWGzZKQ2DWHJW8ijv2hM9YJgL+Rtj1LpJvE4+n3q4ZzKw+O6UdK6TwEnXq50rVbO/g/eW8xVQjKZbhNzV7Rw+0Kj1A43gX9eM2Qo0MLKo0dDzLy1hIR//mLHJU5J6hxdld6r5XG3rV6NLxZssjZX2UEftuZ6wR+F7mxjopnUpaVbkrRU9Yieo2QxhGKllgVJzok1ZfJgWeGm+MvxEeIyIdX9gMfz8Mr0mIeWh1ZthmT0JQRO8OJW+ujvSDJyX9DyN1ACpNlC4v+4ZqJwZ4eiz8WbXXpsQ2SOhY9Rih1R23xWIVkkCdrM4z3mwGwfhFk8A+61tF+zgY9rqzjKNJx8nFzddAEvHaHy+jZnDQAbcEi0aJ1vFgExXm0PQHxPStpyh/mGZIGgMvlw==

          script: |
            cd /home/ocman/codebook-final4
            git pull origin master
            pip install -r requirements.txt
            python manage.py migrate
